<% layout('./layout/app') -%>
<div class="row">
    <a href="/">Go back to event page</a>
</div>

<div class="row mt-5 mb-5">
    <table class="table table-bordered  text-center">
        <thead>
            <th style="width: 100px;">EventID</th>
            <th>Name</th>
            <th style="width: 200px;">Date</th>
            <th>Venue</th>
        </thead>
        <tbody>
            <% for(let i = 0; i < eventData.length; i++) { let event = eventData[i]; %>
            <tr>
                <td style="text-align: center;">
                    <%=event.eventID%>
                </td>
                <td style="width: 200px;">
                    <%=event.name%>
                </td>
                <td>
                    <% var cdate = new Date(event.eventDate).toLocaleString('en-US', {
                                timeZone: 'America/New_York'
                            }); %>
                    <%=cdate%>
                </td>
                <td style="width: 200px;">
                    <%=' ' + event.venue.name + ', ' + event.venue.city + ', ' + event.venue.state%>
                </td>
            </tr>
            <% } %>
        </tbody>
    </table>
</div>

<div class="row">
    <!-- <table class="table table-striped table-bordered text-center">
        <thead>
            <th>Date</th>
            <th>Event</th>
            <th>TT</th>
            <th>MP</th>
            <th>ST</th>
            <th>SV</th>
        </thead>
        <tbody>
        </tbody>
        <% for(let i = 0; i< data.length; i++) { 
            for(let j = 0; j < data[i].events.length; j++) {
        %>
        <tr>
            <% if(j == 0) { %>
            <td rowspan="<%=data[i].events.length%>">
                <%=data[i].datetime.replace(', 7:00:00 PM', '').trim()%>
            </td>
            <% } %>
            <td>
                <%=data[i].events[j].eventID%>
            </td>
            <td>
                <%=(data[i].events[j].ticket != null && data[i].events[j].ticket.totalTickets) ? data[i].events[j].ticket.totalTickets : ''%>
            </td>
            <td>
                <%=(data[i].events[j].ticket != null && data[i].events[j].ticket.minTicketPrice) ? data[i].events[j].ticket.minTicketPrice : ''%>
            </td>
            <td>
                <%=(data[i].events[j].ticket != null) ? (i > 0  && data[i-1].events[j].ticket != null) ? data[i].events[j].ticket.soldNum - data[i-1].events[j].ticket.soldNum :  data[i].events[j].ticket.soldNum : ''%>
            </td>
            <td>
                <%=(data[i].events[j].ticket != null) ? (i > 0  && data[i-1].events[j].ticket != null) ? data[i].events[j].ticket.soldVolume - data[i-1].events[j].ticket.soldVolume :  data[i].events[j].ticket.soldVolume : ''%>
            </td>
        </tr>
        <% } } %>

    </table> -->
    <table class="table table-bordered table-striped">
        <thead>
            <th></th>
            <th>Event</th>
            <%  for(let i = 0; i < data.length ; i++) { %>
            <th>
                <%=data[i].datetime.replace(', 7:00:00 PM', '').trim()%>
            </th>
            <% } %>
        </thead>
        <tbody>
            <!-- TT -->
            <% for(let j = 0; j < eventIDs.length; j++) { let eventID = eventIDs[j]; %>
            <tr>
                <% if(j == 0) { %>
                <td rowspan="<%=eventIDs.length%>">TT</td>
                <% }%>
                <td>
                    <%=eventID%>
                </td>
                <%  for(let i = 0; i < data.length; i++)  { %>
                <td>
                    <%=(data[i].events[j].ticket != null && data[i].events[j].ticket.totalTickets) ? data[i].events[j].ticket.totalTickets : ''%>
                </td>
                <% } %>
            </tr>
            <% } %>
            <!-- MP -->
            <% for(let j = 0; j < eventIDs.length; j++) { let eventID = eventIDs[j]; %>
            <tr>
                <% if(j == 0) { %>
                <td rowspan="<%=eventIDs.length%>">MP</td>
                <% }%>
                <td>
                    <%=eventID%>
                </td>
                <%  for(let i = 0; i < data.length; i++)  { %>
                <td>
                    <%=(data[i].events[j].ticket != null && data[i].events[j].ticket.minTicketPrice) ? data[i].events[j].ticket.minTicketPrice : ''%>
                </td>
                <% } %>
            </tr>
            <% } %>
            <!-- ST -->
            <% for(let j = 0; j < eventIDs.length; j++) { let eventID = eventIDs[j]; %>
            <tr>
                <% if(j == 0) { %>
                <td rowspan="<%=eventIDs.length%>">ST</td>
                <% }%>
                <td>
                    <%=eventID%>
                </td>
                <%  for(let i = 0; i < data.length; i++)  { %>
                <td>
                    <%=(data[i].events[j].ticket != null) ? (i > 0  && data[i-1].events[j].ticket != null) ? data[i].events[j].ticket.soldNum - data[i-1].events[j].ticket.soldNum :  data[i].events[j].ticket.soldNum : ''%>
                </td>
                <% } %>
            </tr>
            <% } %>
            <!-- SV -->
            <% for(let j = 0; j < eventIDs.length; j++) { let eventID = eventIDs[j]; %>
                <tr>
                    <% if(j == 0) { %>
                    <td rowspan="<%=eventIDs.length%>">ST</td>
                    <% }%>
                    <td>
                        <%=eventID%>
                    </td>
                    <%  for(let i = 0; i < data.length; i++)  { %>
                    <td>
                            <%=(data[i].events[j].ticket != null) ? (i > 0  && data[i-1].events[j].ticket != null) ? data[i].events[j].ticket.soldVolume - data[i-1].events[j].ticket.soldVolume :  data[i].events[j].ticket.soldVolume : ''%>
                    </td>
                    <% } %>
                </tr>
                <% } %>
        </tbody>
    </table>
</div>

<div class="row mt-5 mb-5">
    <p>Total Tickets</p>
    <div class="" id="chart-tt" style="height: 200px;width: 100%;">
    </div>
</div>

<div class="row mt-5 mb-5">
    <p>Min Price</p>
    <div class="" id="chart-mp" style="height: 200px;width: 100%;">
    </div>
</div>

<div class="row mt-5 mb-5">
    <p>Sold Tickets</p>
    <div class="" id="chart-st" style="height: 200px;width: 100%;">
    </div>
</div>

<div class="row mt-5 mb-5">
    <p>Sold Volume</p>
    <div class="" id="chart-sv" style="height: 200px;width: 100%;">
    </div>
</div>

<script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/morris.js/0.5.1/morris.min.js"></script>
<script src="/js/compare.js"></script>